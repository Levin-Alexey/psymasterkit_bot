from aiogram import Router, F
from aiogram.types import CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, InputFile
from sqlalchemy import select
from database import AsyncSessionLocal
from models import User

results_router = Router()


@results_router.callback_query(F.data == "view_participant_results")
async def handle_view_participant_results(callback: CallbackQuery):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(User).where(User.telegram_id == callback.from_user.id)
        )
        user = result.scalar_one_or_none()

    is_psych = bool(user and user.is_psychologist)

    if is_psych:
        await callback.message.answer_photo(photo="https://iimg.su/i/tRGYFX")

        text = (
            '‚≠êÔ∏è <b>–î–∏–Ω–∞: –æ—Ç —Å–æ–º–Ω–µ–Ω–∏–π ¬´–Ω–µ –º–æ—ë –ª–∏ —ç—Ç–æ?¬ª –¥–æ 2-—Ö –ø–æ–≤—ã—à–µ–Ω–∏–π —á–µ–∫–∞ '
            '–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</b>\n\n'
            '–ò–Ω–æ–≥–¥–∞ —Ç—ã –º–æ–∂–µ—à—å –±—ã—Ç—å –∫—Ä—É—Ç—ã–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º, –Ω–æ –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ. '
            '–ò —ç—Ç–æ —Å—ä–µ–¥–∞–µ—Ç –≤—Å—é —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ.\n\n'
            '–î–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º –∏ –∏–≥—Ä–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–º, –Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–º–Ω–µ–≤–∞–ª–∞—Å—å: '
            '<b>¬´–ê –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ—à–ª–∞ –≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é?¬ª</b>\n\n'
            '–û–Ω–∞ –≤–µ–ª–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –æ—Ñ–ª–∞–π–Ω ‚Äî –∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —Ç–æ–ª—å–∫–æ –∂–∏–≤–æ–π –∫–æ–Ω—Ç–∞–∫—Ç '
            '–º–æ–∂–µ—Ç –±—ã—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º. –î–æ—Ö–æ–¥ –ø—Ä—ã–≥–∞–ª: –ø—Ä–æ–≤–µ–ª–∞ –∏–≥—Ä—É ‚Äî –µ—Å—Ç—å –¥–µ–Ω—å–≥–∏, '
            '–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî –Ω–µ—Ç –¥–µ–Ω–µ–≥. \n\n'
            '¬´–Ø –Ω–µ –ø—Ä–æ–¥–≤–∏–≥–∞–ª–∞—Å—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–Ω–µ –∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —è –Ω–µ –≤ —Ç—É —Å—Ñ–µ—Ä—É –ø–æ—à–ª–∞¬ª\n\n'
            '–í—Å—ë –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –°—É–ø–µ—Ä–≤–∏–∑–∏–∏. –î–∏–Ω–∞ —É–∑–Ω–∞–ª–∞ —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ '
            '—Å—Ç–æ—Ä–æ–Ω—ã, –ø–æ–Ω—è–ª–∞ —Å–≤–æ—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –∫–∞–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–∞. –í—Å—Ç—Ä–æ–∏–ª–∞ —ç—Ç–æ —á–µ—Ä–µ–∑ '
            '–ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–∞–±–æ—Ç—É —Å –±–∞–¥–¥–∏.\n\n'
            '¬´–Ø –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–≤–æ—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤. '
            '–Ø –ø–æ–Ω—è–ª–∞ ‚Äî —è –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ¬ª\n\n'
            '<b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b>\n\n'
            '‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—à–ª–∞ –≤ –æ–Ω–ª–∞–π–Ω ‚Äî –∫–ª–∏–µ–Ω—Ç—ã –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É –∏ –ï–≤—Ä–æ–ø–µ\n'
            '‚úÖ 2 —Ä–∞–∑–∞ –ø–æ–≤—ã—Å–∏–ª–∞ —á–µ–∫ ‚Äî –±–ª–∞–≥–æ–¥–∞—Ä—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–≤–æ–µ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏\n'
            '‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äî –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∞–º–∞ –Ω–∞ –≤—Å—ë, —á—Ç–æ —Ö–æ—á–µ—Ç\n'
            '‚úÖ –£—à–ª–∏ —Å–æ–º–Ω–µ–Ω–∏—è ‚Äî —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–æ–¥–∏—Ç —Å–µ—Å—Å–∏–∏ —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –∏ –ø–æ–ª—É—á–∞–µ—Ç '
            '–æ—Ç–∑—ã–≤—ã ¬´–∫–∞–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∞–∫ –±—ã—Å—Ç—Ä–æ?!¬ª\n\n'
            '<b>–ù–æ —ç—Ç–æ –µ—â—ë –Ω–µ –≤—Å—ë:</b>\n\n'
            '‚û°Ô∏è –ù–∞—á–∞–ª–∞ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –≤–æ–∫–∞–ª–æ–º\n'
            '‚û°Ô∏è –•–æ–¥–∏—Ç –≤ –ª—É—á—à–∏–π —Å–ø–æ—Ä—Ç–∑–∞–ª –≥–æ—Ä–æ–¥–∞\n'
            '‚û°Ô∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤—É–µ—Ç (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –æ—Ç–ø—É—Å–∫ —Å –º—É–∂–µ–º)\n'
            '‚û°Ô∏è –°–¥–µ–ª–∞–ª–∞ —Ä–µ–º–æ–Ω—Ç –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ –∏ –¥–æ–º–µ ‚Äî –Ω–∞ —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏\n\n'
            '¬´–Ø –º–æ–≥—É —Å–µ–±–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Ç–æ, —á—Ç–æ —Ä–∞–Ω—å—à–µ –∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–Ω—É–∂–Ω—ã–º, –Ω–µ–º—ã—Å–ª–∏–º—ã–º. '
            '–ò –Ω–∞ —á—ë–º —è —ç–∫–æ–Ω–æ–º–∏–ª–∞. –°–µ–π—á–∞—Å —è –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é —Å–∞–º–∞¬ª\n\n'
            '–ö—Ä—É—Ç–æ, –∫–æ–≥–¥–∞ –æ–±—É—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–∞—ë—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç '
            '—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∂–∏–∑–Ω–∏ üíö'
        )
    else:
        await callback.message.answer_photo(photo="https://iimg.su/i/jRIJJE")
        text = (
            '‚≠êÔ∏è <b>–ì—É–∑–µ–ª—å: –æ—Ç ¬´–¥–∞–∂–µ —É –¥–≤–æ—Ä–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ¬ª –¥–æ '
            '–∑–∞–º—É–∂–µ—Å—Ç–≤–∞, –¥–æ–º–∞, –º–∞—à–∏–Ω—ã –∏ –¥–æ—Ö–æ–¥–∞ –º—É–∂–∞ –≤ 10 —Ä–∞–∑ –±–æ–ª—å—à–µ</b>\n\n'
            '–ò–Ω–æ–≥–¥–∞ –∂–∏–∑–Ω—å –±—É–¥—Ç–æ —Å–∂–∏–º–∞–µ—Ç—Å—è. –¢—ã –¥–µ—Ä–∂–∏—à—å –≤—Å—ë –Ω–∞ —Å–µ–±–µ, –Ω–æ –Ω–µ '
            '—á—É–≤—Å—Ç–≤—É–µ—à—å –æ–ø–æ—Ä—ã. –ò –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ —Ç–∞–∫ –±—É–¥–µ—Ç –≤—Å–µ–≥–¥–∞.\n\n'
            '–ü–æ—Å–ª–µ —Ä–∞–∑–≤–æ–¥–∞ –ì—É–∑–µ–ª—å –æ—Å—Ç–∞–ª–∞—Å—å —Å –º–∞–ª–µ–Ω—å–∫–∏–º —Ä–µ–±—ë–Ω–∫–æ–º, —Å—ä—ë–º–Ω–æ–π '
            '–∫–≤–∞—Ä—Ç–∏—Ä–æ–π –∏ —á—É–≤—Å—Ç–≤–æ–º, —á—Ç–æ –∂–∏–≤—ë—Ç ¬´–Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ¬ª. –û–Ω–∞ —Å–æ—Å—Ç—Ä–∏–≥–ª–∞ –≤—Å–µ '
            '–≤–æ–ª–æ—Å—ã, –Ω–µ –º–æ–≥–ª–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–µ–±—è –≤ –∑–µ—Ä–∫–∞–ª–æ, –Ω–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–ª–∞—Å—å. '
            '–†–∞–±–æ—Ç–∞–ª–∞ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö –æ–Ω–ª–∞–π–Ω, –ø—Ä–æ–¥–∞–≤–∞–ª–∞ –Ω–µ–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∫—É—Ä—Å—ã –∏ —Å–º–æ—Ç—Ä–µ–ª–∞ '
            '–≤ –æ–∫–Ω–æ:\n\n'
            '¬´–î–∞–∂–µ —É –¥–≤–æ—Ä–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ, —á–µ–º —É –º–µ–Ω—è¬ª\n\n'
            '–í–Ω–µ—à–Ω–µ –≤—Ä–æ–¥–µ –≤—Å—ë –±—ã–ª–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî —Ö–æ–¥–∏–ª–∞ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –æ–±—â–∞–ª–∞—Å—å, '
            '–Ω–æ –≤–Ω—É—Ç—Ä–∏ –±—ã–ª–∞ –ø—É—Å—Ç–æ—Ç–∞.\n\n'
            '¬´–ö–∞–∫ –æ–∫–∞–∑–∞–ª–æ—Å—å, –ø–æ—Å–ª–µ —Ä–∞–∑–≤–æ–¥–∞ —è —Å–µ–±–µ –≤—Å—ë –ø–µ—Ä–µ–∫—Ä—ã–ª–∞. –í—Å–µ —ç–º–æ—Ü–∏–∏. '
            '–õ–∏—à—å –±—ã —Ç—É–¥–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è. –ò –∫–æ–Ω–µ—á–Ω–æ, —è –Ω–∏—á–µ–≥–æ –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞¬ª\n\n'
            '<b>–° Master Kit –≤—Å—ë –Ω–∞—á–∞–ª–æ –º–µ–Ω—è—Ç—å—Å—è.</b>\n\n'
            '–ì—É–∑–µ–ª—å —Å–¥–µ–ª–∞–ª–∞ –ø–µ—Ä–≤—ã–µ –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ —ç–º–æ—Ü–∏–π ‚Äî –∏ –±—É–¥—Ç–æ –∑–∞–¥—ã—à–∞–ª–∞, –∞ –∑–∞—Ç–µ–º '
            '–ø—Ä–æ—Ä–∞–±–æ—Ç–∞–ª–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —Ö–æ—Ç—è —Å–≤–∏–¥–∞–Ω–∏—è —Ä–∞–Ω—å—à–µ –∫–∞–∑–∞–ª–∏—Å—å –Ω–∞—Å—Ç–æ—è—â–µ–π '
            '–∫–∞—Ç–æ—Ä–≥–æ–π. <b>–í –¥–µ–∫–∞–±—Ä–µ –æ–Ω–∞ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∞—Å—å —Å –±—É–¥—É—â–∏–º –º—É–∂–µ–º, –∞ —á–µ—Ä–µ–∑ '
            '–º–µ—Å—è—Ü –≤—ã—à–ª–∞ –∑–∞–º—É–∂.</b>\n\n'
            '¬´–Ø –ø—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –¥–æ—Ö–æ–¥ –º—É–∂–∞ –ø–æ –≥–æ—Ç–æ–≤–æ–º—É —Å–ø–∏—Å–∫—É ‚Äî "—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ '
            '–≤ 3 —Ä–∞–∑–∞". –î—É–º–∞–ª–∞: "–ù—É —Ç—É—Ç —Ç–æ—á–Ω–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è"¬ª\n\n'
            '–ß–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –µ–º—É –ø–æ–≤—ã—Å–∏–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—É. –ü–æ—Ç–æ–º –æ–Ω –Ω–∞—á–∞–ª –∑–∞–Ω–∏–º–∞—Ç—å—Å—è '
            '–ª—é–±–∏–º—ã–º –¥–µ–ª–æ–º ‚Äî –∏ –∑–∞ —ç—Ç–æ —Å—Ç–∞–ª–∏ —Ö–æ—Ä–æ—à–æ –ø–ª–∞—Ç–∏—Ç—å.\n\n'
            '<b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b>\n\n'
            '‚úÖ –í—ã—à–ª–∞ –∑–∞–º—É–∂ –∑–∞ –ª—é–±–∏–º–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞\n'
            '‚úÖ –†–æ–¥–∏–ª–∞—Å—å –≤—Ç–æ—Ä–∞—è –¥–æ—á—å\n'
            '‚úÖ –ö—É–ø–∏–ª–∏ –¥–æ–º\n'
            '‚úÖ –ö—É–ø–∏–ª–∏ –º–∞—à–∏–Ω—É\n'
            '‚úÖ –î–æ—Ö–æ–¥ –º—É–∂–∞ –≤—ã—Ä–æ—Å –≤ 10 —Ä–∞–∑\n'
            '‚úÖ –í–ø–µ—Ä–≤—ã–µ –≤ –∂–∏–∑–Ω–∏ –ø–æ–ª–µ—Ç–µ–ª–∞ –Ω–∞ —Å–∞–º–æ–ª—ë—Ç–µ\n\n'
            '<b>–ù–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –≤–µ—Ä–Ω—É–ª–∏—Å—å —ç–º–æ—Ü–∏–∏:</b>\n\n'
            '‚û°Ô∏è –ß—É–≤—Å—Ç–≤–æ —Å—á–∞—Å—Ç—å—è\n'
            '‚û°Ô∏è –û–ø–æ—Ä–∞ –≤–Ω—É—Ç—Ä–∏\n'
            '‚û°Ô∏è –°–º—ã—Å–ª –∏ —Ä–∞–¥–æ—Å—Ç—å –≤ –∂–∏–∑–Ω–∏\n\n'
            '¬´–Ø —É–≤–∏–¥–µ–ª–∞: –∫–æ–≥–¥–∞ –º–µ–Ω—è—é—Å—å —è ‚Äî —Ä–∞—Å—Ç—ë—Ç –≤—Å—ë –≤–æ–∫—Ä—É–≥. –≠—Ç–æ —Å—Ç–∞–ª–æ –º–æ–µ–π '
            '–ø–µ—Ä–≤–æ–π –≤–µ—Ä–æ–π –≤ —Å–∏–ª—É –º–µ—Ç–æ–¥–∏–∫–∏¬ª\n\n'
            '–ö—Ä—É—Ç–æ, –∫–æ–≥–¥–∞ –º–µ—Ç–æ–¥–∏–∫–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç ¬´—Å–ø—Ä–∞–≤–∏—Ç—å—Å—è¬ª, –∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç '
            '—Ç–µ–±—è –∫ –∂–∏–∑–Ω–∏ ‚Äî —Å –¥–µ–Ω—å–≥–∞–º–∏, –ª—é–±–æ–≤—å—é, –¥–µ—Ç—å–º–∏ –∏ –æ—â—É—â–µ–Ω–∏–µ–º ¬´—è –¥—ã—à—É¬ª üíö'
        )

    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(
                text="–£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –°—É–ø–µ—Ä–≤–∏–∑–∏–∏",
                callback_data="learn_more_supervision"
            )]
        ]
    )

    await callback.message.answer(text, parse_mode="HTML", reply_markup=keyboard)
    await callback.answer()
