from aiogram import Router, F
from aiogram.types import CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton
from sqlalchemy import select
from database import AsyncSessionLocal
from models import User

supervision_router = Router()


@supervision_router.callback_query(F.data == "learn_more_supervision")
async def handle_learn_more_supervision(callback: CallbackQuery):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ "–°—É–ø–µ—Ä–≤–∏–∑–∏–∏" —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏
    –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤ –∏ –Ω–µ–ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤. –í –∫–æ–Ω—Ü–µ ‚Äî CTA –Ω–∞ –±—Ä–æ–Ω—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.
    """
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(User).where(User.telegram_id == callback.from_user.id)
        )
        user = result.scalar_one_or_none()

    is_psych = bool(user and user.is_psychologist)

    if is_psych:
        text = (
            'üí¨ <b>–•–æ—Ç–∏—Ç–µ –∏–∑ –≤–µ—á–Ω—ã—Ö —Å–æ–º–Ω–µ–Ω–∏–π –≤—ã–π—Ç–∏ –≤ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π '
            '–¥–æ—Ö–æ–¥? –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –≤–∞–º "–°—É–ø–µ—Ä–≤–∏–∑–∏—è"</b>\n\n'
            '–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –∏—Å—Ç–æ—Ä–∏—é –î–∏–Ω—ã ‚Äî –æ—Ç —Å–æ–º–Ω–µ–Ω–∏–π ¬´–º–æ—ë –ª–∏ —ç—Ç–æ?¬ª '
            '–∫ 2-–º –ø–æ–≤—ã—à–µ–Ω–∏—è–º —á–µ–∫–∞ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.\n\n'
            '–≠—Ç–æ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å. –≠—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —Å–æ–±–æ–π –∫–∞–∫ '
            '—ç–∫—Å–ø–µ—Ä—Ç–æ–º.\n\n'
            '<b>–ù–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–º –∑–≤–æ–Ω–∫–µ –º—ã –≤–º–µ—Å—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º:</b>\n\n'
            '‚úì –í–∞—à—É —Ç–µ–∫—É—â—É—é —Ç–æ—á–∫—É –ê (–≥–¥–µ –≤—ã —Å–µ–π—á–∞—Å –∫–∞–∫ –ø—Å–∏—Ö–æ–ª–æ–≥)\n'
            '‚úì –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é —Ç–æ—á–∫—É –ë (–∫—É–¥–∞ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–π—Ç–∏ –∑–∞ –≤—Ä–µ–º—è –°—É–ø–µ—Ä–≤–∏–∑–∏–∏)\n'
            '‚úì –ü–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –≤–∞–º –Ω–∞—à –ø–æ–¥—Ö–æ–¥ –∏–ª–∏ –ª—É—á—à–µ –∏—Å–∫–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å'
        )
        keyboard = InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(
                    text='–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞',
                    callback_data='book_call'
                )]
            ]
        )
    else:
        text = (
            'üí´ <b>–•–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ "–≤—ã–∂–∏–≤–∞–Ω–∏—è" –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∂–∏–∑–Ω—å? –î–∞–≤–∞–π—Ç–µ '
            '–ø—Ä–æ–≤–µ—Ä–∏–º, –ø–æ–º–æ–∂–µ—Ç –ª–∏ –≤–∞–º –°—É–ø–µ—Ä–≤–∏–∑–∏—è</b>\n\n'
            '–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –∏—Å—Ç–æ—Ä–∏—é –ì—É–∑–µ–ª—å ‚Äî –æ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞ –∏ –ø—É—Å—Ç–æ—Ç—ã '
            '–∫ —Å–µ–º—å–µ, –¥–æ–º—É, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è–º –∏ –¥–æ—Ö–æ–¥—É, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞—Å—Ç—ë—Ç.\n\n'
            '–≠—Ç–æ –Ω–µ –≤–æ–ª—à–µ–±—Å—Ç–≤–æ. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞ —Å —Å–æ–±–æ–π –ø–æ —Å–∏—Å—Ç–µ–º–µ.\n'
            '–°—É–ø–µ—Ä–≤–∏–∑–∏—è ‚Äî —ç—Ç–æ –≥–ª—É–±–æ–∫–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –≥–æ—Ç–æ–≤ –º–µ–Ω—è—Ç—å '
            '—Å–≤–æ—é –∂–∏–∑–Ω—å –∏–∑–Ω—É—Ç—Ä–∏.\n\n'
            '<b>–ù–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–º –∑–≤–æ–Ω–∫–µ –º—ã –≤–º–µ—Å—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º:</b>\n'
            '‚úì –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –¥–µ—Ä–∂–∏—Ç –≤ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏\n'
            '‚úì –ö–∞–∫–∏–µ –≥–ª—É–±–∏–Ω–Ω—ã–µ —É–±–µ–∂–¥–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n'
            '‚úì –ü–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –≤–∞–º –°—É–ø–µ—Ä–≤–∏–∑–∏—è –∏–ª–∏ –ª—É—á—à–µ –∏—Å–∫–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å'
        )
        keyboard = InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(
                    text='–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä',
                    callback_data='book_call'
                )]
            ]
        )

    await callback.message.answer(text, parse_mode='HTML', reply_markup=keyboard)
    await callback.answer()
